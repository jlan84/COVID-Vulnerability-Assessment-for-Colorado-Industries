import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from df_functions import *

plt.style.use('fivethirtyeight')

# read in data
df = pd.read_csv('../data/COVID-Data.csv')

# copy data to new datafram and insert columns/drop 0 value columns
covidWeeklyDF = df.copy()
covidWeeklyDF.insert(loc=5, column='Industry', value='')
covidWeeklyDF.dropna(how='all',axis=1, inplace=True)
covidWeeklyDF['Colorado county (exposure location)'].replace("Colorado", "Clear Creek", inplace=True)


# Declare variables for new Industry column
AFFH = ['Farm/dairy', 'Agriculture', 'Gathering']

mining_og = ['Coal Mine']

utilities = []

manufacturing = ['Wood Pallet Manufacturer', 'Industry', 'Manufacturing', 'Dairy Plant',
                'Beverage Bottling Plant', 'Meat Processing', 'Manufacturing/Retail',
                'Meat Packing Plant', 'Manufacturing ', 'Frozen food manufacturing',
                'Food Manufacturer', 'Food Manufacturing', 'Factory', 'Food Packaging Industry',
                'Slaughterhouse/Meat packing plant', 'Manufactured foods facility', 
                'Meat Processing Plant (Lamb)', 'Manufacturer (Hand Sanitizer)', 'Dog Food Plant',
                'Potato Processing Plant', 'Poultry Processing Center', 'Commercial Bakery',
                'Meat Processing Plant', 'Food manufacturing', 'Food Manufacturer ',
                'Agricultural and Manufactured food facility']

government = ['Prison/jail', 'Correctional facility', 'Community Corrections']

construction = ['Construction Site', 'Construction', 'Construction site', 'construction site', 
                'Construction', 'House Painting Business', 'Tile/Construction',
                'Construction company', 'Lumber/Construction ', 'Gutters']

comminfo = []

wholsale_trade = ['Produce Wholesale Warehouse']

retail_trade = ['Grocery store', 'Retail', 'Store', 'Tile Company; Industry','Thrift store',
                'Home Improvement Retailer', 'Home improvement retailer', 'Traffic safety equipment supplier company',
                'Car dealership ', 'Building materials supplier']

transp_warehouse = ['Distribution', 'Distribution Center', 'Potato Warehouse', 'Factory/Warehouse',
                    'Food distributor', 'Warehouse Distribution', 'Produce Repack Warehouse/Distribution',
                    'Pipe distributor', 'Food Distribution', 'Warehouse', 'Mail distribution center']

prof_serv_mgmt = ['Maintenance Services', 'Waste management', 'Electrical Contractor',
                  'Distribution/Marketing Service', 'Landscaping company', 'Office/indoor workspace', 
                  'Bridge Tournament ', 'Cleaning Company', 'Fencing company', 'Landscaping', 
                  'Environmental Laboratory', 'THC Laboratory', 
                  'Provides parts and technical assistance for rebar processing machines',
                  'Airport operations/support','Laundry Services', 'Laundry Services', 'Steam Laundry',]

fin_ins_rs = ['Bank']

education = ['Educational Program', 'University']

HC_SA = ['Child care center', 'Healthcare, assisted living residence', 'Healthcare, skilled nursing facility',
        'Healthcare, combined care', 'Healthcare other', 'Healthcare, outpatient', 'Independent Living Facility',
        'Group home', 'Healthcare, dialysis', 'Residential Care Facility',
        'Personal Care Alternative (PCA) staffed apartment', 'Congregate shelter','OBGYN Clinic',
        'Opioid Treatment Facility', 'Shelter', 'Adult group home', 'Rehab center',
        'Inpatient rehabilitation', 'Hospice ', 'Assisted living and memory care', 'Dental Office',
        'Behavioral health', 'Rehab and Senior Living', 'Homeless shelter', 'assisted living and memory care',
        'Community correctional facility', 'Rehab ', 'Skilled nursing, continuing care retirement community',
        'Youth shelter', 'Assisted living & independent living ', 'Inpatient psychiatry']

A_E = []

hospitality = ['Restaurant  fast food', 'Hotel/lodge/resort', 'Restaurant sit down',
               'Restaurant other or unknown type', 'Beauty Salon', 'Camp', 'Pool/water park', 
               'Hot Spring/Spa', 'Bakery ', 'Bakery', 'Restaurant/Adult Entertainment',
               'Ice Cream', 'Copper Mountain Employee Housing', 'Recreation Facility and Restaurant',
              ]

other_service = ['Workplace, no store front, in homes']

# add values to Industry column
industries = ['AFFH', 'Mining/O&G', 'Utilities',
             'Manufacturing', 'Government', 'Construction', 
             'Comm/Info', 'Wholesale Trade', 'Retail Trade',
             'Transp/Warehouse', 'Prof Serv and Mgmt',
             'Fin/Ins/RS', 'Education',
             'HC and SA', 'A&E', 'Hospitality','Other Service']

industry_lists = [AFFH, mining_og, utilities, manufacturing, government, construction, comminfo, wholsale_trade,
                  retail_trade, transp_warehouse, prof_serv_mgmt, fin_ins_rs, education, HC_SA, A_E, 
                  hospitality, other_service]

for i in range(len(industries)):
    values_to_column(covidWeeklyDF, industry_lists[i], industries[i], 3, 5)
for i in range(len(industries)):
    values_to_column(covidWeeklyDF, industry_lists[i], industries[i], 4, 5)

# industries_df = create_df(industry_lists, industries)
salaries_dic = {}
salaries_list = [32900,76300,66200,55000,58100,44600,47800,52900,35500,49300,75600,57300,46200,45600,
                 37700, 26600,36300]

for i in range(len(salaries_list)):
    salaries_dic[industries[i]] = salaries_list[i]

add_column(covidWeeklyDF, salaries_dic, 'Industry', 'Median Salary', 5, 6)

#Importing percentage population by county
def p2f(x):
    return float(x.strip('%'))/100

df2 = pd.read_csv('../data/wealth-and-health-by-county.csv', header=1, nrows=64)
df2.dropna(how='all', axis=1, inplace=True)
df2['Ratio_Hispanic_Pop'] = df2['Perc_Hispanic_Pop'].str.rstrip('%').astype('float') / 100.0

hispanic_pop_by_county_df = df2[['CTYNAME', 'Ratio_Hispanic_Pop']].copy()
hispanic_pop_by_county_df['Perc_Hispanic_Pop'] = hispanic_pop_by_county_df['Ratio_Hispanic_Pop']*100
hispanic_pop_by_county_df['CTYNAME'] = hispanic_pop_by_county_df['CTYNAME'].str.rstrip()
pop_dic = convert_to_dict(hispanic_pop_by_county_df, 0, 2)

# covidWeeklyDF['Colorado county (exposure location)'] = covidWeeklyDF['Colorado county (exposure location)'].str.strip()

add_column(covidWeeklyDF, pop_dic,'Colorado county (exposure location)', 'Hispanic Population Percentage', 7,8)
covidWeeklyDF.to_csv('../data/updated_table.csv')