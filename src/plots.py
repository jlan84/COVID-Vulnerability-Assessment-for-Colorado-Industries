import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from df_functions import *

plt.style.use('bmh')



execute = True
if __name__ == "__main__" and execute:

    df = pd.read_csv('../data/good_clean_data.csv')

    county_infection_group = df.groupby('CTYNAME').sum().copy().reset_index()
    county_infection_group.sort_values('Total Staff Infected', ascending=False,
                                        inplace=True)
    cty_inf_group_non_zero = county_infection_group[county_infection_group['Total Staff Infected'] != 0]

    county_hispanic_group = df.groupby('CTYNAME').mean().copy().reset_index()
    county_hispanic_group.sort_values('Hispanic Population Percentage', 
                                       ascending=False, inplace=True)
    cty_hisp_top_34 = county_hispanic_group.iloc[:34, :]

    industry_group = df.groupby(['Industry']).mean().copy().reset_index()
    industry_group.sort_values('Median Salary', ascending=False, inplace=True)

    color = make_colors('darkviolet', 34)
    lst1 = [10,15,5,19,11,17,21,7,26,33]
    for i in lst1:
        color[i] = 'red'

    fig, ax = plt.subplots(figsize=(12,8))
    make_bar_plot(ax, cty_hisp_top_34, 'Hispanic Population Percentage',
                    'CTYNAME', 'Hispanic Poulation % by County', color=color)
    
    ax.set_ylabel('Percentage')
    
    fig, ax = plt.subplots(figsize=(12,8))
    make_sns_bar_plot(ax, cty_inf_group_non_zero, 'Total Staff Infected',
                    'CTYNAME', 'Total Staff Infected by County',
                    color='firebrick')
    
    color = make_colors('green', 12)
    lst1 = [6,4,9,11,2]
    for i in lst1:
        color[i] = 'red'
    
    fig, ax = plt.subplots(figsize=(12,10))
    make_bar_plot(ax, industry_group, 'Median Salary', 'Industry','Median Salary by Industry',
                    color=color)

    ax.set_ylabel('Yearly Income $')
    plt.tight_layout()
    plt.show()


    df = pd.read_csv('../data/His_Pop_Infection_Merge.csv')

    fig, ax = plt.subplots()
    make_scatter_plot(ax, df['Hispanic Population Percentage'], 
                    df['Total Staff Infected'], 'Infected vs Hispanic Population %',
                    'blueviolet')

    ax.set_xlabel('Hispanic Population %', fontsize=14)
    ax.set_ylabel('Staff Infected', fontsize=14)
   
        
    hispanic_staff_infected = pd.read_csv('../data/Hispanic_Staff_Infected_by_Industry.csv')
    hispanic_staff_infected.sort_values('Total Staff Infected', ascending=False, inplace=True)

    fig, ax = plt.subplots(figsize=(12,8))

    make_sns_bar_plot(ax, hispanic_staff_infected, 'Total Staff Infected',
                        'Industry', 'Staff Infected by Industry',
                        color='firebrick', label='Total Staff Infected')

    make_sns_bar_plot(ax, hispanic_staff_infected, 'Hispanic Staff Infected',
                        'Industry', 'Staff Infected by Industry',
                        color='blue', label='Hispanic Staff Infected')

    ax.set_ylabel('# of Infected')
    plt.tight_layout()
    ax.legend()
    plt.show()                    


    #Pearson Correlation

    HSPInfection = merge_hispPop_Infection[['CTYNAME', 'Total Staff Infected', 
                                            'Hispanic Population Percentage']]
    infected_hispPop_pearson_corr = HSPInfection.corr()